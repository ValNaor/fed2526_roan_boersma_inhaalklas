!function(e){"use strict";var t;!function(e){e.LOAD_USERCENTRICS_BANNER="uc",e.RECEIVE_CONSENT_FROM_APP="app-external",e.CONSENT_MANAGEMENT_OFF="off"}(t||(t={}));var n="arL_G7jv7",r="__webview-consent__",o="__webview-consent-external__",a="dataLayer",i=2e3,s="uc-settings",c="ucConsentEventV2";function getCookie(e){var t=(document.cookie||"").match(";?\\s*"+e+"=([^;]*)");return t&&t[1]}function getSafeFetch(e){var t=void 0===e?{}:e,n=t.cookieName,r=t.headerName;function fetchPolyfill(e,t){return void 0===t&&(t={}),new Promise((function(n,r){var o=new XMLHttpRequest;if(o.open(t.method||"GET",e),void 0!==t.headers){var a=t.headers;Object.keys(a).forEach((function(e){o.setRequestHeader(e,a[e])}))}o.onload=function(){n({status:o.status,statusText:o.statusText,text:function text(){return Promise.resolve(o.responseText)},json:function json(){return new Promise((function(e,t){try{e(JSON.parse(o.responseText))}catch(e){t(e)}}))}})},o.onerror=function(e){return r(e)},o.send(t.body)}))}function safeFetch(e,t){var n,r=Object.assign({},t);"credentials"in r||(r.credentials="same-origin"),"same-origin"===r.credentials&&(n=void 0===safeFetch.cookieName?"":getCookie(safeFetch.cookieName)||"",r.headers=r.headers||{},void 0!==safeFetch.headerName&&(r.headers[safeFetch.headerName]=n));var o=[].slice.call(arguments);return o[1]=r,(window.fetch||fetchPolyfill).apply(void 0,o)}return safeFetch.cookieName=n,safeFetch.headerName=r,safeFetch}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function __spreadArray(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var u="1.0.0+37937d8b";function canLog(){return!!getCookie("uc-debug")||!!window.zconsent_debug_on}var d={log:function log(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];canLog()&&(e=console.log).call.apply(e,__spreadArray([console],__read(t),!1))},error:function error(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];canLog()&&(e=console.error).call.apply(e,__spreadArray(__spreadArray([console],__read(t),!1),["script version "+u],!1))}};function getTrack(e){return window[e]=window[e]||[],function track(t){void 0!==window[e]&&"function"==typeof window[e].push?window[e].push(t):d.error("window['"+e+"'].push is not a function")}}var l="zconsent:get-app-consents",f="https://zconsent";function getAppConsents(e){var t=getSafeFetch();try{return Promise.race([t(e,{credentials:"omit"}),new Promise((function(e,t){window.setTimeout((function(){t(new Error("Fetching consents from the app timed out"))}),i)}))])}catch(e){return Promise.reject(e||new Error("Fetching consents from the app failed"))}}function triggerGTMEvents(e,t){var n={usc_origin:"from server setting",event:"consents_initialized"};t.forEach((function(e){return n[e.name]=e.status}));var r=getTrack(e);d.log("Triggering event on the GTM bus:",n),r(n)}function publishConsentsForAPI(e){window[r]=e}var g=3e5,v="hash-error",m="zConsentSettings",h="zConsentRetries",p="zConsentCache";function getHash(e){var t=JSON.stringify(e),n=5381,r=0;for(r=0;r<t.length;r++){n=(n<<5)+n+t.charCodeAt(r)}var o=0xffffffffff&n;return(o<0?"0":"1")+Math.abs(o).toString(16)}function updateLocalRetryInfo(e){void 0===e&&(e={});try{window.localStorage.setItem(h,JSON.stringify(e)),d.log("Updated retry info",e)}catch(e){d.error(e)}}function areConsentsStale(e){var t=__read(function readLocalSettings(){try{var e=window.localStorage.getItem(m);if(!e||0===e.length)return[v,0];var t=JSON.parse(e)||{};return[t.hash||v,t.timestamp||0]}catch(e){return d.error(e),[v,0]}}(),2),n=t[0],r=t[1];if((new Date).getTime()-r>g)return!0;var o=getHash(e);return d.log("Comparing data hash",n,o),n!==o}var w={};var y,C=3e5,S=5e3;function saveConsentToBE(e){var t=e.data,n=e.cookieName,r=e.headerName,o=e.retryCount,a=void 0===o?0:o,i=e.timeout,s=void 0===i?0:i,c=e.ucVersion,u=void 0===c?"1":c;function doRequest(){return d.log("Consent data to be saved",t),getSafeFetch({cookieName:n,headerName:r})("/api/consents",{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json","X-UserCentrics-Version":u}}).then((function(e){return function is2xx(e){return 2===Math.floor(Number(e)/100)}(e.status)?e.text():Promise.reject(e)})).then((function(e){!function updateLocalSettings(e){try{var t=(new Date).getTime(),n=getHash(e),r={hash:n,timestamp:t};window.localStorage.setItem(m,JSON.stringify(r)),d.log("Updated consent data hash",n,t)}catch(e){d.error(e)}}(t),updateLocalRetryInfo(),function measurePerf(e){window.performance&&window.performance.measure&&!w.hasOwnProperty(e)&&(window.performance.measure(e),w[e]=!0)}("consent-saved"),d.log(e)}),(function(e){if(void 0===e&&(e={statusText:"Non-HTTP error"}),d.error("Error saving consent. HTTP Status: "+e.status+", StatusText: "+e.statusText+", attempt: "+a),a++,function is5xx(e){return 5===Math.floor(Number(e)/100)}(e.status)||void 0===e.status){var o=function getRetryDelay(e){return e<1?0:Math.floor(Math.random()*Math.min(C,S*Math.pow(2,e-1)))}(a);return saveConsentToBE({data:t,cookieName:n,headerName:r,retryCount:a,timeout:o,ucVersion:u})}return updateLocalRetryInfo(),Promise.reject(e)}))}return window.clearTimeout(y),a>0&&(d.log("Scheduling retry #"+a+" in "+s+" msec..."),updateLocalRetryInfo({nextAt:s+(new Date).getTime(),retryCount:a})),0===s?doRequest():new Promise((function(e){y=window.setTimeout((function(){return e(doRequest())}),s)}))}function transformConsentsForBackend(e,t){return e&&Array.isArray(e)?e.map((function(e){return function transformConsentForBackend(e,t){var n=function getMostRecentHistory(e){var t,n;return null===(n=null===(t=null==e?void 0:e.consent)||void 0===t?void 0:t.history)||void 0===n?void 0:n.reduce((function(e,t){return!e||(null==t?void 0:t.timestamp)>(null==e?void 0:e.timestamp)?t:e}),null)}(t);return{consentId:e,consentStatus:t.consent.status,categorySlug:t.categorySlug,dataProcessingService:t.name,action:null==n?void 0:n.action,language:null==n?void 0:n.language}}(t,e)})).sort((function(e,t){return e.dataProcessingService.localeCompare(t.dataProcessingService)})):[]}var _,N="https://app.usercentrics.eu/browser-ui/latest/loader.js",E=function isScriptLoaded(e){return Array.from(document.scripts).some((function(t){return t.id===e}))};function loadUserCentrics(e){if(function setUcDomains(){var e="https://www.zalando.de/cross-domain-bridge.html";window.UC_UI_DOMAINS?window.UC_UI_DOMAINS.crossDomainConsentSharingIFrame=e:window.UC_UI_DOMAINS={crossDomainConsentSharingIFrame:e}}(),!E("usercentrics-cmp")){var t=function createUCScriptEl(e){var t=document.createElement("script");t.type="text/javascript",t.id="usercentrics-cmp",t.src=N,t.dataset.settingsId=e.ucId,t.dataset.language=e.lang,t.dataset.euMode="true",t.async=!0,e.crossOrigin&&(t.crossOrigin="anonymous");e.previewMode&&(t.dataset.version="preview");return t}(e);!function insertUCScriptEl(e){var t,n=document.getElementsByTagName("script")[0];null===(t=n.parentNode)||void 0===t||t.insertBefore(e,n)}(t)}}function initialize(e){var n=e.mode,r=e.cookieName,i=e.crossOrigin,s=void 0!==i&&i,g=e.headerName,v=e.lang,m=e.ucId,w=e.defaultConsentsApp,y=e.ucPreviewMode,C=void 0!==y&&y,S=e.dataLayer,N=void 0===S?a:S;return function render(){d.log("GTM consent UI loader, v. "+u+" initialising");var e=getTrack(N||""),a=function debounce(e,t){var n;return function(){var r=arguments;window.clearTimeout(n),n=window.setTimeout((function(){e.apply(void 0,r),n=void 0}),t)}}((function(){var e;if(void 0===_&&(_=window.setTimeout((function(){return window.location.reload()}),8634e4)),null===(e=window.UC_UI)||void 0===e?void 0:e.getServicesBaseInfo){var t=transformConsentsForBackend(window.UC_UI.getServicesBaseInfo(),window.UC_UI.getControllerId());if(areConsentsStale(t)){var n=function readLocalRetryInfo(){try{return JSON.parse(window.localStorage.getItem(h)||"{}")||{}}catch(e){return d.error(e),{}}}(),o=(new Date).getTime();saveConsentToBE({data:t,cookieName:r,headerName:g,retryCount:n.retryCount||0,timeout:o<n.nextAt?n.nextAt-o:0,ucVersion:"2"}).then((function(){!function updateConsentCache(e){try{var t=(new Date).getTime(),n={cache:e,timestamp:t};window.localStorage.setItem(p,JSON.stringify(n)),d.log("Updated local consent cache at",t)}catch(e){d.error(e)}}(t)})).catch((function(e){return d.error("Could not save consent. HTTP Status: "+e.status+", StatusText: "+e.statusText)}))}else d.log("Skipping BE save as settings didn't change")}else d.error(new Error("usercentrics not available"))}),250);if(n===t.LOAD_USERCENTRICS_BANNER){window.addEventListener(c,(function(e){d.log("UserCentrics ".concat(c,":"),e),a()})),loadUserCentrics({ucId:m,lang:v,previewMode:C,crossOrigin:s});var i=document.querySelectorAll("a[href='#uc-central-modal-show'], a[href='#uc-info-modal-show'], a[href='#uc-banner-show'], a[href='#uc-banner-toggle']");null==i||i.forEach((function(e){return e.addEventListener("click",(function(){var e;return null===(e=window.UC_UI)||void 0===e?void 0:e.showSecondLayer()}))}))}else{if(n===t.RECEIVE_CONSENT_FROM_APP)return function loadWebViewBridge(e,t){return void 0===t&&(t=[]),getAppConsents(l).catch((function(e){return d.error(e),getAppConsents(f)})).then((function(e){if(200===e.status)return e.json();throw new Error(e.statusText)})).then((function(t){d.log("Received consent data from the app:",t);var n=t.consents;triggerGTMEvents(e,n),publishConsentsForAPI(n)})).catch((function(n){if(window[o]){d.log("Using external window variable fallback");try{var r=JSON.parse(window[o]).consents;return triggerGTMEvents(e,r),void publishConsentsForAPI(r)}catch(e){d.error("Error parsing JSON",e)}}throw d.error(n),d.log("Using default consents for the app:",t),triggerGTMEvents(e,t),publishConsentsForAPI(t),n}))}(N||"",w);n===t.CONSENT_MANAGEMENT_OFF&&e({event:"consents_initialized",usc_origin:"from server setting"})}}()}function isAppWebView(){return!!getCookie("xzma")}function ucSettingsId(){return getCookie(s)||n}function start(){var e=isAppWebView()?t.RECEIVE_CONSENT_FROM_APP:t.LOAD_USERCENTRICS_BANNER;if(initialize({mode:e,cookieName:"frsx",headerName:"x-xsrf-token",lang:(document.documentElement.lang||document.body.lang||"").split("-")[0].toLowerCase()||"de",ucId:ucSettingsId(),defaultConsentsApp:[{name:"Google Analytics for Zalando",status:!1}]}),e===t.LOAD_USERCENTRICS_BANNER||e===t.RECEIVE_CONSENT_FROM_APP)try{window.localStorage.setItem("cookieBarVisibility","hidden")}catch(e){console.error(e)}}start(),e.isAppWebView=isAppWebView,e.start=start,e.ucSettingsId=ucSettingsId,Object.defineProperty(e,"__esModule",{value:!0})}({});
